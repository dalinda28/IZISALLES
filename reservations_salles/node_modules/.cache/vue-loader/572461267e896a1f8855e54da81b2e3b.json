{"remainingRequest":"/Users/home/Documents/GitHub/room_reservation/reservations_salles/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!/Users/home/Documents/GitHub/room_reservation/reservations_salles/src/views/AdminReservations.vue?vue&type=style&index=0&id=ab964568&scoped=true&lang=css","dependencies":[{"path":"/Users/home/Documents/GitHub/room_reservation/reservations_salles/src/views/AdminReservations.vue","mtime":1644420517284},{"path":"/Users/home/Documents/GitHub/room_reservation/reservations_salles/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/home/Documents/GitHub/room_reservation/reservations_salles/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js","mtime":1616796459000},{"path":"/Users/home/Documents/GitHub/room_reservation/reservations_salles/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/home/Documents/GitHub/room_reservation/reservations_salles/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/home/Documents/GitHub/room_reservation/reservations_salles/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js","mtime":1616796459000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5jb250YWluZXItZmx1aWQgewogICAgbWFyZ2luOjAgYXV0bzsgCn0KLmhlbGxvYmFyIHsKICAgIGZvbnQtc2l6ZToyNXB4Owp9Ci50aXRsZWJhcnsKICAgIGZvbnQtc2l6ZToxOHB4OwogICAgcGFkZGluZzogM3B4Owp9Ci5iYXIgewogICAgbWFyZ2luLWJvdHRvbTogNSU7CiAgICBtYXJnaW4tdG9wOiA1JTsKfQoub3ZlcmxheXsKICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgIHRvcDogMDsKICAgIGJvdHRvbTogMDsKICAgIGxlZnQ6IDA7CiAgICByaWdodDogMDsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC42KTsKfQoubW9kYWwtZGlhbG9newogICAgdG9wOjE1JQp9Ci5tb2RhbF9tc2d7CiAgICBmb250LXNpemU6IDE4cHg7Cn0KLnJvd3sKICAgIGJhY2tncm91bmQ6IHdoaXRlOwp9Cgo="},{"version":3,"sources":["/Users/home/Documents/GitHub/room_reservation/reservations_salles/src/views/AdminReservations.vue"],"names":[],"mappings":";AA6XA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;IACb,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACjB;AACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;IACN,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAClB;AACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACd,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AAChB;AACA,CAAC,CAAC,CAAC,EAAE;IACD,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;IACjB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;AAClB;AACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IACf,CAAC,CAAC,CAAC,EAAE,CAAC;IACN,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IACT,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IACP,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IACR,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAClC;AACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACT,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACV;AACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACN,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACnB;AACA,CAAC,CAAC,CAAC,CAAC;IACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AACrB","file":"/Users/home/Documents/GitHub/room_reservation/reservations_salles/src/views/AdminReservations.vue","sourceRoot":"","sourcesContent":["<template>\n    <div>\n        <div class=\"container-fluid\">\n            <div class=\"row bar\">\n                <div class=\"col-lg-12 bg-dark\">\n                    <h1 class=\"hellobar text-center text-light display-4 pt-2\">Bonjour {{ $store.state.firstName }}</h1>\n                </div>\n                <div class=\"col-lg-12 bg-secondary\">\n                    <h2 class=\"titlebar text-center text-light display-4 pt-2\">Gestion des réservations</h2>\n                </div>\n            </div>        \n            <div class=\"row\">\n                <div class=\"col-lg-12 pr-0 pl-0\">\n                    <table class=\"table table-striped table-bordered\">\n                        <thead>\n                            <tr class=\"filters\">\n                                <th><input type=\"number\" class=\"form-control\" name=\"id\" id=\"id\" v-model=\"idFilterComputed\" placeholder=\"Id\"></th>\n                                <th>\n                                    <select class=\"form-control\" id=\"nomsSalles\" v-model=\"salleFilterComputed\">\n                                        <option value=\"\">Toutes les salles</option>\n                                        <option v-for=\"(salle, index) in salles\" v-bind:key=\"index\"> {{ salle.nom }} </option>\n                                    </select>\n                                </th>\n                                <th><input type=\"text\" class=\"form-control\" name=\"lastname\" id=\"lastname\" v-model=\"nameFilterComputed\" placeholder=\"Nom\"></th>\n                                <th><datepicker class=\"form-control\" id=\"datePicker\" format=\"DD/MM/yyyy\" v-model=\"dateFilterComputed\"/></th>\n                                <th>\n                                    <select class=\"form-control\" id=\"timeSelect\" v-model=\"timeFilterComputed\">\n                                        <option value=\"\">Tout</option>\n                                        <option value=\"matin\"> Matin </option>\n                                        <option value=\"aprem\"> Après-midi </option>\n                                    </select>\n                                </th>\n                                <th colspan=\"2\"><button  class=\"btn btn-secondary\" name=\"emptyFilters\" id=\"emptyFilters\" @click=\"emptyFilters\">Vider les champs</button></th>\n                            </tr>\n                            <tr class=\"text-center bg-info text-light\">\n                                <th scope=\"col\" class=\"align-middle\">ID de la réservation</th>\n                                <th scope=\"col\" class=\"align-middle\">Nom de la salle </th>\n                                <th scope=\"col\" class=\"align-middle\">Nom de l'utilisateur</th>\n                                <th scope=\"col\" class=\"align-middle\">Date</th>\n                                <th scope=\"col\" class=\"align-middle\">Heure</th>\n                                <th scope=\"col\" colspan=\"2\" class=\"align-middle\"> Actions </th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr class=\"text-center\" v-for=\"reservation in filterResults\" v-bind:key=\"reservation.details_reservation.id\" v-bind:id=\"reservation.details_reservation.id\">\n                                <td>{{ reservation.details_reservation.id }}</td>\n                                <td>{{ reservation.details_salle.nom}} </td>\n                                <td>{{ reservation.details_user.nom }} &nbsp;{{ reservation.details_user.prenom }} </td>\n                                <td>{{ reservation.details_reservation.date }}</td>\n                                <td>\n                                    <span v-if=\"reservation.details_reservation.heure === 'matin'\"> Matin</span> \n                                    <span v-else> Après-midi</span> \n                                </td>\n                                <td><button class=\"btn btn-sm btn-info\" @click=\"modifier\" > Modifier </button></td>\n                                <td><button class=\"btn btn-sm btn-danger\" type=\"button\" @click=\"openDeleteDialog(reservation.details_reservation.id)\"> Supprimer </button></td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n            <!-- Popup modification date réservation -->\n            <div class=\"overlay\" v-if=\"showModifModal\">\n                <div class=\"modal-dialog\">\n                    <div class=\"modal-content\">\n                        <div class=\"modal-header\">\n                            <h5 class=\"modal-title\"> Modification de la date de réservation </h5>\n                            <button type=\"button\" class=\"close\" @click=\"showModifModal=false\">\n                                <span aria-hidden=\"true\">&times; </span>\n                            </button>\n                        </div>\n                        <div class=\"modal-body p-4\">\n                            <div>\n                                <span> Date: <datepicker id=\"datePicker\" v-model=\"dateComputed\"/> </span> <br>   \n                                <div class=\"form-check\">\n                                    <input class=\"form-check-input\" type=\"radio\" name=\"periode\" id=\"periode1\" value=\"matin\" v-model=\"heureComputed\" :checked=\"selectedReserv.details_reservation.heure==='matin'\">\n                                    <label class=\"form-check-label\" for=\"periode1\">\n                                        Matin\n                                    </label>\n                                </div>\n                                <div class=\"form-check\">\n                                    <input class=\"form-check-input\" type=\"radio\" name=\"periode\" id=\"periode2\" value=\"aprem\" v-model=\"heureComputed\" :checked=\"selectedReserv.details_reservation.heure==='aprem'\">\n                                    <label class=\"form-check-label\" for=\"periode2\">\n                                        Après-midi\n                                    </label>\n                                </div> <hr>\n                                <span>Nom de salle: {{ selectedReserv.details_salle.nom }}</span> <br>\n                                <span>Nombre de places: {{ selectedReserv.details_salle.places }}</span> <br>\n                                <span>Nombre postes étudiant: {{ selectedReserv.details_salle.postes_etud }}</span> <br>\n                                <span>Poste enseignant:\n                                    <span v-if=\"selectedReserv.details_salle.poste_prof === '1'\"> Oui </span>\n                                    <span v-else> Non </span>\n                                </span> <br>\n                                <span>Climatisation: \n                                    <span v-if=\"selectedReserv.details_salle.climatisation === '1'\"> Oui </span>\n                                    <span v-else> Non </span>\n                                </span> <br>\n                            </div>\n                        </div>\n                        <div class=\"modal-footer\">\n                            <button type=\"button\" class=\"btn btn-info\" @click=\"save\" :disabled=\"selectedReserv.details_reservation.date == dateString && selectedReserv.details_reservation.heure == heure\">Confirmer</button>\n                            <button type=\"button\" class=\"btn btn-secondary\" @click=\"showModifModal=false\" data-dismiss=\"modal\">Annuler</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <!-- Popup réponse de la tentative de modification ou de suppression (réussie ou échouée) -->\n            <div class=\"overlay\" v-if=\"showReponseModal\">\n                <div class=\"modal-dialog\">\n                    <div class=\"modal-content\">\n                        <div class=\"modal-body p-4\">\n                            <div>\n                                <p id=\"reponseReserv\"></p>             \n                            </div>\n                        </div>\n                        <div class=\"modal-footer\">\n                            <button type=\"button\" class=\"btn btn-secondary\" @click=\"refreshReservationsDetails\" data-dismiss=\"modal\">OK</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <!--Supprimer un utilisateur-->\n            <div class=\"overlay\" v-if=\"showDeleteModal\">\n                <div class=\"modal-dialog\">\n                    <div class=\"modal-content\">\n                        <div class=\"modal-header\">\n                            <h5>Supprimer une réservation </h5>\n                            <button type=\"button\" class=\"close\" @click=\"showDeleteModal=false\">\n                                <span aria-hidden=\"true\">&times; </span>\n                            </button>\n                        </div>\n                        <div class=\"modal-body p-4\">\n                            <p class=\"modal_msg\"> Êtes vous sûr de supprimer la réservation '{{ selectedReserv.details_reservation.id }}' ?</p>\n                        </div>\n                        <div class=\"modal-footer\">\n                            <button class=\"btn btn-danger btn\" @click=\"deleteReserv(selectedReserv.details_reservation.id)\">Oui</button>\n                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n                            <button class=\"btn btn-secondary btn\" @click=\"showDeleteModal=false\">Non</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport axios from 'axios';\nimport Datepicker from 'vue3-datepicker';\n\nexport default {\n    name: 'Reservation',\n    components: {\n        Datepicker\n    },\n    data() {\n        return {\n            // Filtres utilisés par l'utilisateur pour trouver une réservation\n            filters: {\n                id: \"\", \n                userName: \"\", \n                salleName: \"\", \n                date: \"\",\n                time: \"\"\n            },\n\n            filterResults: [],\n\n            // Reservation sélectionnée à travers les boutons \"modifier\" et \"supprimer\"\n            selectedReserv: [],\n\n            // Toutes les réservations, toutes les salles, tous les users\n            reservations: [],\n            salles: [],\n            users: [],\n\n            //Chaque réservation avec ses infos (date,heure,etc) et les infos de la salle réservée (nom et autres caractéristiques)\n            reservations_infos: [],\n            \n            date: new Date(),\n            dateString: null,\n            heure: null,\n\n            //Condition d'affichage des pop-ups\n            showReponseModal: false,\n            showModifModal: false,\n            showDeleteModal: false\n        }\n    },\n    mounted() {\n        this.updateUserReservationsdetails();\n    },\n    methods: {\n        modifier: function(event){\n            this.showModifModal = true;\n\n            var reserv_id = event.target.parentElement.parentElement.id;\n            this.selectedReserv = this.reservations_infos.filter(reserv => reserv.details_reservation.id == reserv_id)[0];\n\n            this.date = new Date(this.selectedReserv.details_reservation.date);\n            this.dateString = this.selectedReserv.details_reservation.date;\n            this.heure = this.selectedReserv.details_reservation.heure;\n        },\n\n        openDeleteDialog(id){\n            this.showDeleteModal = true;\n            this.selectedReserv = this.reservations_infos.filter(reserv => reserv.details_reservation.id == id)[0];\n        },\n        updateUserReservationsdetails(){\n            this.reservations = [];\n            this.salles = [];\n            this.users = [];\n            this.reservations_infos = [];\n            axios.get(\"http://localhost:8888/reservations_salles/src/api/controllers/ReservationsResource.php\") \n            .then((response) => {\n                this.reservations = response.data;\n\n                axios.get(\"http://localhost:8888/reservations_salles/src/api/controllers/SallesResource.php\")\n                .then((response) => {\n                    this.salles = response.data;\n\n                    axios.get(\"http://localhost:8888/reservations_salles/src/api/controllers/UsersResource.php\")\n                    .then((response) => {\n                        this.users = response.data;\n                        for (let i = 0; i < this.reservations.length; i++) {\n                            var salle_id = this.reservations[i].id_salle;\n                            var salle = this.salles.filter(salle => salle.id == salle_id)[0];\n                            var user_id = this.reservations[i].id_user;\n                            var user = this.users.filter(user => user.id == user_id)[0];\n                            this.reservations_infos[i] = {details_reservation: this.reservations[i], details_salle: salle, details_user: user};\n                        }\n                        this.filterResults = [];\n                        for (var i=0; i<this.reservations_infos.length; i++){\n                            this.filterResults[i] = this.reservations_infos[i];\n                        }\n                    });\n                });\n            });\n        },\n         refreshReservationsDetails() {\n            this.showReponseModal = false;\n            this.updateUserReservationsdetails();\n        },\n\n        formatDate(d){\n            var month = '' + (d.getMonth() + 1);\n            var day = '' + d.getDate();\n            var year = d.getFullYear();\n\n            if (month.length < 2) {\n                month = '0' + month;\n            }             \n            if (day.length < 2) {\n                day = '0' + day;\n            }             \n            return [year, month, day].join('-');\n        },\n        save(){\n            this.showModifModal = false;\n            this.showReponseModal = true;\n            let formData = new FormData();\n            formData.append('date', this.dateString);\n            formData.append('heure', this.heure);\n            axios.put(\"http://localhost:8888/reservations_salles/src/api/controllers/ReservationsResource.php\", \n            JSON.stringify({\n                id_reserv: this.selectedReserv.details_reservation.id,\n                id_salle: this.selectedReserv.details_salle.id,\n                date: this.dateString,\n                heure: this.heure\n            }))\n            .then((response) => { \n                console.log(response.data);\n                if (response.data){\n                    document.getElementById(\"reponseReserv\").textContent = \"La modification de votre réservation a été validée avec succès\"\n                }\n                else {\n                    document.getElementById(\"reponseReserv\").textContent = \"La modification de votre réservation n'est pas valide\"\n                }\n            });\n        },\n        deleteReserv(reserv_id){\n            this.showReponseModal = true;\n            this.showDeleteModal = false;\n            axios.delete(\"http://localhost:8888/reservations_salles/src/api/controllers/ReservationsResource.php?id=\"+reserv_id)\n                .then ((response) => {\n                    if (response.data){\n                        document.getElementById(\"reponseReserv\").textContent = \"Votre réservation à été annulée avec succès\"\n                    }\n                });\n        },\n\n        //Functions about filters\n\n        changeFilterResults(){\n            this.filterResults = [];\n            for (var i=0; i<this.reservations_infos.length; i++){\n                this.filterResults[i] = this.reservations_infos[i];\n            }\n\n            this.filterResults = this.filters.id != \"\" ? this.filterResults.filter(reserv => parseInt(reserv.details_reservation.id, 10) == parseInt(this.filters.id, 10)) : this.filterResults;\n            this.filterResults = this.filters.userName != \"\" ? this.filterResults.filter(reserv => reserv.details_user.nom.toLowerCase().includes(this.filters.userName.toLowerCase()) || reserv.details_user.prenom.toLowerCase().includes(this.filters.userName.toLowerCase())) : this.filterResults;\n            this.filterResults = this.filters.salleName != \"\" ? this.filterResults.filter(reserv => reserv.details_salle.nom === this.filters.salleName) : this.filterResults;\n            this.filterResults = this.filters.date != \"\" ? this.filterResults.filter(reserv => reserv.details_reservation.date === this.formatDate(this.filters.date)) : this.filterResults;\n            this.filterResults = this.filters.time != \"\" ? this.filterResults.filter(reserv => reserv.details_reservation.heure === this.filters.time) : this.filterResults;\n        },\n\n        emptyFilters(){\n            this.idFilterComputed = \"\";\n            this.nameFilterComputed = \"\";\n            this.salleFilterComputed = \"\";\n            this.dateFilterComputed = \"\";\n            this.timeFilterComputed = \"\";\n        }\n    },\n    computed: {\n    dateComputed: {\n        get: function() {\n            return this.date;\n        },\n        set: function(input) {\n            this.date = input;\n            this.dateString = this.formatDate(this.date);\n        }\n    },\n    heureComputed: {\n        get: function() {\n            return this.heure;\n        },\n        set: function(input) {\n            this.heure = input;    \n        }\n    },\n    idFilterComputed: {\n        get: function() {\n            return this.filters.id;\n        },\n        set: function(input) {\n            this.filters.id = input;\n            this.changeFilterResults()\n        }\n    },\n    salleFilterComputed: {\n        get: function() {\n            return this.filters.salleName;\n        },\n        set: function(input) {\n            this.filters.salleName = input;  \n            this.changeFilterResults()   \n        }\n    },\n    nameFilterComputed: {\n        get: function() {\n            return this.filters.userName;\n        },\n        set: function(input) {\n            this.filters.userName = input; \n            this.changeFilterResults()      \n        }\n    },\n    dateFilterComputed: {\n        get: function() {\n            return this.filters.date;\n        },\n        set: function(input) {\n            this.filters.date = input; \n            this.changeFilterResults()    \n        }\n    },\n    timeFilterComputed: {\n        get: function() {\n            return this.filters.time;\n        },\n        set: function(input) {\n            this.filters.time = input;   \n            this.changeFilterResults()   \n        }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.container-fluid {\n    margin:0 auto; \n}\n.hellobar {\n    font-size:25px;\n}\n.titlebar{\n    font-size:18px;\n    padding: 3px;\n}\n.bar {\n    margin-bottom: 5%;\n    margin-top: 5%;\n}\n.overlay{\n    position: fixed;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: rgba(0, 0, 0, 0.6);\n}\n.modal-dialog{\n    top:15%\n}\n.modal_msg{\n    font-size: 18px;\n}\n.row{\n    background: white;\n}\n\n</style>"]}]}